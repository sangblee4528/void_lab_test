# Void Lab Test 진행 과정 정리 (2026-01-15)

본 문서는 `agent_native_loop` 서버에 Human-in-the-Loop(HITL) 승인 기능을 추가한 작업 내용을 정리한 기록입니다.

## 1. 주요 추가 기능: 터미널 승인 시스템

### 1-1. 기능 개요
- **목적**: LLM이 도구를 자동 실행하기 전에 사용자의 명시적 승인을 요구
- **방식**: 서버 터미널에서 `y/n` 입력으로 승인/거절 결정

### 1-2. 동작 흐름
```
LLM 응답 → 도구 호출 감지 → 터미널에 승인 요청 표시 → y/n 입력 대기
  → 승인(y): 도구 실행 후 다음 루프 진행
  → 거절(n): 도구 실행 건너뜀, 루프 즉시 종료
```

### 1-3. 승인 화면 예시
```
============================================================
🔧 도구 실행 승인 요청
   도구: read_file
   인자: {
     "filename": "a.txt"
   }
============================================================
실행하시겠습니까? (y/n): _
```

## 2. 구현 상세

### 2-1. 새로 추가된 함수

| 함수명 | 설명 |
|--------|------|
| `ask_terminal_approval(func_name, args)` | 터미널에서 도구 실행 승인 요청, y/n 입력 대기 |

### 2-2. 수정된 파일

| 파일 | 수정 내용 |
|------|-----------|
| `agent_native_loop_server.py` | `asyncio` import 추가, `ask_terminal_approval()` 함수 추가, 도구 실행 로직에 승인 체크 삽입, 거절 시 루프 중단 로직 |
| `test_request.py` | 테스트 URL 포트 8011로 수정 |

### 2-3. 기술적 구현 포인트
- **비동기 처리**: `asyncio.run_in_executor()`를 사용하여 동기 `input()` 호출이 이벤트 루프를 블로킹하지 않도록 처리
- **다국어 입력 지원**: `y`, `yes`, `예`, `ㅛ` 모두 승인으로 인식
- **거절 시 응답**: "사용자가 도구 실행을 거절하여 작업을 중단했습니다." 메시지 반환

## 3. 테스트 방법

```bash
# 1. 서버 실행 (터미널 1)
cd agent_native_loop
python agent_native_loop_server.py

# 2. 테스트 요청 (터미널 2)
python test_request.py

# 3. 서버 터미널에서 승인 요청 확인 후 y 또는 n 입력
```

## 4. 향후 계획

- [ ] REST API 기반 승인 시스템 추가 (웹 UI 연동용)
- [ ] 승인 이력 DB 저장 기능
- [ ] 도구별 자동 승인 화이트리스트 설정

---
**기록자**: Antigravity (AI Assistant)  
**날짜**: 2026-01-14
